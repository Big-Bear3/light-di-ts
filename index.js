/*! For license information please see index.js.LICENSE.txt */
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(this,(()=>(()=>{var e={630:(e,t,n)=>{var r;!function(e){!function(t){var r="object"==typeof globalThis?globalThis:"object"==typeof n.g?n.g:"object"==typeof self?self:"object"==typeof this?this:function(){try{return Function("return this;")()}catch(e){}}()||function(){try{return(0,eval)("(function() { return this; })()")}catch(e){}}(),s=a(e);function a(e,t){return function(n,r){Object.defineProperty(e,n,{configurable:!0,writable:!0,value:r}),t&&t(n,r)}}void 0!==r.Reflect&&(s=a(r.Reflect,s)),function(e,t){var n=Object.prototype.hasOwnProperty,r="function"==typeof Symbol,s=r&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",a=r&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",i="function"==typeof Object.create,o={__proto__:[]}instanceof Array,c=!i&&!o,u={create:i?function(){return U(Object.create(null))}:o?function(){return U({__proto__:null})}:function(){return U({})},has:c?function(e,t){return n.call(e,t)}:function(e,t){return t in e},get:c?function(e,t){return n.call(e,t)?e[t]:void 0}:function(e,t){return e[t]}},l=Object.getPrototypeOf(Function),f="function"==typeof Map&&"function"==typeof Map.prototype.entries?Map:function(){var e={},t=[],n=function(){function e(e,t,n){this._index=0,this._keys=e,this._values=t,this._selector=n}return e.prototype["@@iterator"]=function(){return this},e.prototype[a]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var n=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var n=this._find(e,!0);return this._values[n]=t,this},t.prototype.delete=function(t){var n=this._find(t,!1);if(n>=0){for(var r=this._keys.length,s=n+1;s<r;s++)this._keys[s-1]=this._keys[s],this._values[s-1]=this._values[s];return this._keys.length--,this._values.length--,R(t,this._cacheKey)&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new n(this._keys,this._values,r)},t.prototype.values=function(){return new n(this._keys,this._values,s)},t.prototype.entries=function(){return new n(this._keys,this._values,i)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[a]=function(){return this.entries()},t.prototype._find=function(e,t){if(!R(this._cacheKey,e)){this._cacheIndex=-1;for(var n=0;n<this._keys.length;n++)if(R(this._keys[n],e)){this._cacheIndex=n;break}}return this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function r(e,t){return e}function s(e,t){return t}function i(e,t){return[e,t]}}(),d="function"==typeof Set&&"function"==typeof Set.prototype.entries?Set:function(){function e(){this._map=new f}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.keys()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[a]=function(){return this.keys()},e}(),p="function"==typeof WeakMap?WeakMap:function(){var e=16,t=u.create(),r=s();return function(){function e(){this._key=s()}return e.prototype.has=function(e){var t=a(e,!1);return void 0!==t&&u.has(t,this._key)},e.prototype.get=function(e){var t=a(e,!1);return void 0!==t?u.get(t,this._key):void 0},e.prototype.set=function(e,t){return a(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=a(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=s()},e}();function s(){var e;do{e="@@WeakMap@@"+o()}while(u.has(t,e));return t[e]=!0,e}function a(e,t){if(!n.call(e,r)){if(!t)return;Object.defineProperty(e,r,{value:u.create()})}return e[r]}function i(e,t){for(var n=0;n<t;++n)e[n]=255*Math.random()|0;return e}function o(){var t,n=(t=e,"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(t)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(t)):i(new Uint8Array(t),t):i(new Array(t),t));n[6]=79&n[6]|64,n[8]=191&n[8]|128;for(var r="",s=0;s<e;++s){var a=n[s];4!==s&&6!==s&&8!==s||(r+="-"),a<16&&(r+="0"),r+=a.toString(16).toLowerCase()}return r}}(),h=r?Symbol.for("@reflect-metadata:registry"):void 0,y=function(){var e;return!I(h)&&j(t.Reflect)&&Object.isExtensible(t.Reflect)&&(e=t.Reflect[h]),I(e)&&(e=function(){var e,n,r,s;I(h)||void 0===t.Reflect||h in t.Reflect||"function"!=typeof t.Reflect.defineMetadata||(e=function(e){var t=e.defineMetadata,n=e.hasOwnMetadata,r=e.getOwnMetadata,s=e.getOwnMetadataKeys,a=e.deleteMetadata,i=new p;return{isProviderFor:function(e,t){var n=i.get(e);return I(n)?!!s(e,t).length&&(I(n)&&(n=new d,i.set(e,n)),n.add(t),!0):n.has(t)},OrdinaryDefineOwnMetadata:t,OrdinaryHasOwnMetadata:n,OrdinaryGetOwnMetadata:r,OrdinaryOwnMetadataKeys:s,OrdinaryDeleteMetadata:a}}(t.Reflect));var a=new p,i={registerProvider:o,getProvider:u,setProvider:y};return i;function o(t){if(!Object.isExtensible(i))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case e===t:break;case I(n):n=t;break;case n===t:break;case I(r):r=t;break;case r===t:break;default:void 0===s&&(s=new d),s.add(t)}}function c(t,a){if(!I(n)){if(n.isProviderFor(t,a))return n;if(!I(r)){if(r.isProviderFor(t,a))return n;if(!I(s))for(var i=A(s);;){var o=K(i);if(!o)return;var c=F(o);if(c.isProviderFor(t,a))return $(i),c}}}if(!I(e)&&e.isProviderFor(t,a))return e}function u(e,t){var n,r=a.get(e);return I(r)||(n=r.get(t)),I(n)?(I(n=c(e,t))||(I(r)&&(r=new f,a.set(e,r)),r.set(t,n)),n):n}function l(e){if(I(e))throw new TypeError;return n===e||r===e||!I(s)&&s.has(e)}function y(e,t,n){if(!l(n))throw new Error("Metadata provider not registered.");var r=u(e,t);if(r!==n){if(!I(r))return!1;var s=a.get(e);I(s)&&(s=new f,a.set(e,s)),s.set(t,n)}return!0}}()),!I(h)&&j(t.Reflect)&&Object.isExtensible(t.Reflect)&&Object.defineProperty(t.Reflect,h,{enumerable:!1,configurable:!1,writable:!1,value:e}),e}(),g=function(e){var t=new p,n={isProviderFor:function(e,n){var r=t.get(e);return!I(r)&&r.has(n)},OrdinaryDefineOwnMetadata:function(e,t,n,s){r(n,s,!0).set(e,t)},OrdinaryHasOwnMetadata:function(e,t,n){var s=r(t,n,!1);return!I(s)&&E(s.has(e))},OrdinaryGetOwnMetadata:function(e,t,n){var s=r(t,n,!1);if(!I(s))return s.get(e)},OrdinaryOwnMetadataKeys:function(e,t){var n=[],s=r(e,t,!1);if(I(s))return n;for(var a=A(s.keys()),i=0;;){var o=K(a);if(!o)return n.length=i,n;var c=F(o);try{n[i]=c}catch(e){try{$(a)}finally{throw e}}i++}},OrdinaryDeleteMetadata:function(e,n,s){var a=r(n,s,!1);if(I(a))return!1;if(!a.delete(e))return!1;if(0===a.size){var i=t.get(n);I(i)||(i.delete(s),0===i.size&&t.delete(i))}return!0}};return y.registerProvider(n),n;function r(r,s,a){var i=t.get(r),o=!1;if(I(i)){if(!a)return;i=new f,t.set(r,i),o=!0}var c=i.get(s);if(I(c)){if(!a)return;if(c=new f,i.set(s,c),!e.setProvider(r,s,n))throw i.delete(s),o&&t.delete(r),new Error("Wrong provider for target.")}return c}}(y);function b(e,t,n){if(m(e,t,n))return!0;var r=z(t);return!D(r)&&b(e,r,n)}function m(e,t,n){var r=B(t,n,!1);return!I(r)&&E(r.OrdinaryHasOwnMetadata(e,t,n))}function w(e,t,n){if(m(e,t,n))return v(e,t,n);var r=z(t);return D(r)?void 0:w(e,r,n)}function v(e,t,n){var r=B(t,n,!1);if(!I(r))return r.OrdinaryGetOwnMetadata(e,t,n)}function O(e,t,n,r){B(n,r,!0).OrdinaryDefineOwnMetadata(e,t,n,r)}function _(e,t){var n=M(e,t),r=z(e);if(null===r)return n;var s=_(r,t);if(s.length<=0)return n;if(n.length<=0)return s;for(var a=new d,i=[],o=0,c=n;o<c.length;o++){var u=c[o];a.has(u)||(a.add(u),i.push(u))}for(var l=0,f=s;l<f.length;l++)u=f[l],a.has(u)||(a.add(u),i.push(u));return i}function M(e,t){var n=B(e,t,!1);return n?n.OrdinaryOwnMetadataKeys(e,t):[]}function C(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function I(e){return void 0===e}function D(e){return null===e}function j(e){return"object"==typeof e?null!==e:"function"==typeof e}function k(e,t){switch(C(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var n=3===t?"string":5===t?"number":"default",r=x(e,s);if(void 0!==r){var a=r.call(e,n);if(j(a))throw new TypeError;return a}return function(e,t){if("string"===t){var n=e.toString;if(T(n)&&!j(s=n.call(e)))return s;if(T(r=e.valueOf)&&!j(s=r.call(e)))return s}else{var r;if(T(r=e.valueOf)&&!j(s=r.call(e)))return s;var s,a=e.toString;if(T(a)&&!j(s=a.call(e)))return s}throw new TypeError}(e,"default"===n?"number":n)}function E(e){return!!e}function S(e){var t=k(e,3);return"symbol"==typeof t?t:function(e){return""+e}(t)}function P(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function T(e){return"function"==typeof e}function N(e){return"function"==typeof e}function R(e,t){return e===t||e!=e&&t!=t}function x(e,t){var n=e[t];if(null!=n){if(!T(n))throw new TypeError;return n}}function A(e){var t=x(e,a);if(!T(t))throw new TypeError;var n=t.call(e);if(!j(n))throw new TypeError;return n}function F(e){return e.value}function K(e){var t=e.next();return!t.done&&t}function $(e){var t=e.return;t&&t.call(e)}function z(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===l)return t;if(t!==l)return t;var n=e.prototype,r=n&&Object.getPrototypeOf(n);if(null==r||r===Object.prototype)return t;var s=r.constructor;return"function"!=typeof s||s===e?t:s}function B(e,t,n){var r=y.getProvider(e,t);if(!I(r))return r;if(n){if(y.setProvider(e,t,g))return g;throw new Error("Illegal state.")}}function U(e){return e.__=void 0,delete e.__,e}e("decorate",(function(e,t,n,r){if(I(n)){if(!P(e))throw new TypeError;if(!N(t))throw new TypeError;return function(e,t){for(var n=e.length-1;n>=0;--n){var r=(0,e[n])(t);if(!I(r)&&!D(r)){if(!N(r))throw new TypeError;t=r}}return t}(e,t)}if(!P(e))throw new TypeError;if(!j(t))throw new TypeError;if(!j(r)&&!I(r)&&!D(r))throw new TypeError;return D(r)&&(r=void 0),function(e,t,n,r){for(var s=e.length-1;s>=0;--s){var a=(0,e[s])(t,n,r);if(!I(a)&&!D(a)){if(!j(a))throw new TypeError;r=a}}return r}(e,t,n=S(n),r)})),e("metadata",(function(e,t){return function(n,r){if(!j(n))throw new TypeError;if(!I(r)&&!function(e){switch(C(e)){case 3:case 4:return!0;default:return!1}}(r))throw new TypeError;O(e,t,n,r)}})),e("defineMetadata",(function(e,t,n,r){if(!j(n))throw new TypeError;return I(r)||(r=S(r)),O(e,t,n,r)})),e("hasMetadata",(function(e,t,n){if(!j(t))throw new TypeError;return I(n)||(n=S(n)),b(e,t,n)})),e("hasOwnMetadata",(function(e,t,n){if(!j(t))throw new TypeError;return I(n)||(n=S(n)),m(e,t,n)})),e("getMetadata",(function(e,t,n){if(!j(t))throw new TypeError;return I(n)||(n=S(n)),w(e,t,n)})),e("getOwnMetadata",(function(e,t,n){if(!j(t))throw new TypeError;return I(n)||(n=S(n)),v(e,t,n)})),e("getMetadataKeys",(function(e,t){if(!j(e))throw new TypeError;return I(t)||(t=S(t)),_(e,t)})),e("getOwnMetadataKeys",(function(e,t){if(!j(e))throw new TypeError;return I(t)||(t=S(t)),M(e,t)})),e("deleteMetadata",(function(e,t,n){if(!j(t))throw new TypeError;if(I(n)||(n=S(n)),!j(t))throw new TypeError;I(n)||(n=S(n));var r=B(t,n,!1);return!I(r)&&r.OrdinaryDeleteMetadata(e,t,n)}))}(s,r),void 0===r.Reflect&&(r.Reflect=e)}()}(r||(r={}))}},t={};function n(r){var s=t[r];if(void 0!==s)return s.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return(()=>{"use strict";n.r(r),n.d(r,{AUTO:()=>x,DependencyConfig:()=>T,Inject:()=>N,Injectable:()=>P,MODULE:()=>F,MushroomService:()=>R,STOP_DEEP_CONFIG:()=>A,by:()=>j,of:()=>D,registerDepsConfig:()=>K,req:()=>k,setAsDependencyConfig:()=>S,setAsInjectable:()=>E}),n(630);class e{static#e={type:"multiple"};static#t={lazy:!1};static get defaultInjectableOptions(){return e.defaultConfigAlreadyGot=!0,e.#e}static get defaultInjectOptions(){return e.defaultConfigAlreadyGot=!0,e.#t}static{this.defaultConfigAlreadyGot=!1}static{this.globalConfigAlreadySet=!1}static{this.originalClassPropName="__mp_class"}static{this.originalInstancePropName="__mp_instance"}static{this.afterClassStoreInstanceCreatedCbName="__mp_afterClassStoreInstanceCreated"}static{this.AUTO=Symbol("DI-AUTO")}static{this.STOP_DEEP_CONFIG=Symbol("DI-STOP-DEEP-CONFIG")}static{this.MODULE=Symbol("DI-VALUE-DEPS-MODULE")}}const t="\n    ";class s{collect(e,t){this.dependenciesMap.set(e,t)}getInjectableOptions(t){const n=this.dependenciesMap.get(t);if(!n)return e.defaultInjectableOptions;for(const t of Object.keys(e.defaultInjectableOptions))Reflect.has(n,t)||(n[t]=e.defaultInjectableOptions[t]);return n}contains(e){return this.dependenciesMap.has(e)}constructor(){this.dependenciesMap=new Map}static get instance(){return s._instance||(s._instance=new s),s._instance}}class a{static{this.consolePrintable=!0}static{this.histories=[]}static warn(e,t){a.histories.push({type:"warn",code:e,message:t}),a.consolePrintable&&console.warn(`(${e}) ${t}`)}static error(e,t){a.histories.push({type:"error",code:e,message:t}),a.consolePrintable&&console.error(`(${e}) ${t}`)}static throwError(e,t){throw a.histories.push({type:"throw",code:e,message:t}),a.consolePrintable?new Error(`(${e}) ${t}`):new Error}static getHistory(){return a.histories}static clearHistory(){a.histories.splice(0)}static toggleConsolePrintable(e){a.consolePrintable=e}}class i{constructor(){this.dependenciesConfigMap=new Map,this.dependenciesSymbolConfigMap=new Map}collect(e,t){"symbol"==typeof e?(this.dependenciesSymbolConfigMap.has(e)&&a.warn("20004",`您在多处进行了 "${e.toString()}" 的依赖配置！`),this.dependenciesSymbolConfigMap.set(e,t)):(this.dependenciesConfigMap.has(e)&&a.warn("20003",`您在多处进行了 "${e.name}" 的依赖配置！`),this.dependenciesConfigMap.set(e,t))}getConfigMethod(e){return"symbol"==typeof e?this.dependenciesSymbolConfigMap.get(e):this.dependenciesConfigMap.get(e)}static get instance(){return i._instance||(i._instance=new i),i._instance}}class o{constructor(e,t){this.usingClass=e,this.args=t,this.afterInstanceCreate=void 0,this.afterInstanceFetch=void 0}}class c{constructor(){this.singletonDependenciesMap=new Map}addDependency(e,t){this.singletonDependenciesMap.set(e,t)}getDependency(e){return this.singletonDependenciesMap.get(e)}removeDependency(e){return this.singletonDependenciesMap.delete(e)}static get instance(){return c._instance||(c._instance=new c),c._instance}}class u{constructor(){}addNodeAndCheckRing(e,t){if(!t)return this.initialNode=new l(e),this.valueToNode=new Map,void this.valueToNode.set(e,this.initialNode);const n=this.valueToNode.get(t);let r=this.valueToNode.get(e);return r?(n.addNextNode(r),this.checkRing(r)):(r=new l(e),n.addNextNode(r),void this.valueToNode.set(r.value,r))}checkRing(e){const t=[{value:e,path:[e.value]}];let n=!0;for(;t.length>0;){const r=t.pop();if(!n&&r.value===e)return r.path;if(r.value.nextNodesCount()>0){const e=[];for(const t of r.value.nextNodes)e.push({value:t,path:[...r.path,t.value]});t.unshift(...e)}n&&(n=!1)}}}class l{constructor(e){this.value=e}addNextNode(e){this.nextNodes||(this.nextNodes=new Set),this.nextNodes.add(e)}nextNodesCount(){return this.nextNodes?this.nextNodes.size:0}}class f{constructor(){this.classToInjectMembers=new Map,this.instanceToLazyInjectMembers=new WeakMap}addInjectMember(t,n,r,s=e.defaultInjectOptions){const a=this.classToInjectMembers.get(t);a?s.lazy?a.lazyMembers.push({memberName:n,definedClassOrSymbol:r}):a.members.push({memberName:n,definedClassOrSymbol:r}):s.lazy?this.classToInjectMembers.set(t,{members:[],lazyMembers:[{memberName:n,definedClassOrSymbol:r}],lazyMembersHandled:!1}):this.classToInjectMembers.set(t,{members:[{memberName:n,definedClassOrSymbol:r}],lazyMembers:[],lazyMembersHandled:!1})}handleInstanceMembers(e,t){const n=this.classToInjectMembers.get(e.prototype);if(n){const e=h.instance;for(const r of n.members)"symbol"==typeof r.definedClassOrSymbol?t[r.memberName]=e.searchDependencyBySymbol(r.definedClassOrSymbol):t[r.memberName]=e.searchDependencyByClass(r.definedClassOrSymbol)}const r=Object.getPrototypeOf(e);r&&this.handleInstanceMembers(r,t)}handleInstanceLazyMembers(e){const t=this.classToInjectMembers.get(e.prototype);if(t&&!t.lazyMembersHandled){const n=h.instance,r=this.instanceToLazyInjectMembers;for(const i of t.lazyMembers)Reflect.defineProperty(e.prototype,i.memberName,{enumerable:!0,configurable:!0,get(){let e,t=r.get(this);if(t){if(Reflect.has(t,i.memberName))return t[i.memberName]}else t={},r.set(this,t);return e="symbol"==typeof i.definedClassOrSymbol?n.searchDependencyBySymbol(i.definedClassOrSymbol):n.searchDependencyByClass(i.definedClassOrSymbol),t[i.memberName]=e,e},set(t){"frozen"===s.instance.getInjectableOptions(e).setTo&&a.throwError("29019",`该类 (${e.name}) 的实例已置为frozen，无法对其属性重新赋值！`);let n=r.get(this);n||(n={},r.set(this,n)),n[i.memberName]=t}})}const n=Object.getPrototypeOf(e);n&&this.handleInstanceLazyMembers(n)}handleInstanceStaticMember(t,n,r,i=e.defaultInjectOptions){if(i.lazy){let e,i=!1;Reflect.defineProperty(t,n,{enumerable:!0,configurable:!0,get:()=>(i||(e="symbol"==typeof r?h.instance.searchDependencyBySymbol(r):h.instance.searchDependencyByClass(r),i=!0),e),set(n){"frozen"===s.instance.getInjectableOptions(t).setTo&&a.throwError("29020",`该类 (${t.name}) 的实例已置为frozen，无法对其属性重新赋值！`),e=n,i=!0}})}else"symbol"==typeof r?Reflect.set(t,n,h.instance.searchDependencyBySymbol(r)):Reflect.set(t,n,h.instance.searchDependencyByClass(r))}static get instance(){return f._instance||(f._instance=new f),f._instance}}class d{constructor(){this.dependenciesSearcher=h.instance,this.dependenciesGraph=new u,this.creatingInstanceClassQueue=[],this.isInjecting=!1}createDependency(e,t){let n=!1;this.isInjecting||(this.isInjecting=!0,n=!0);const r=this.createInstance(e,t);return n&&(d._instance=null),r}getCreatingInstanceClass(){if(0!==this.creatingInstanceClassQueue.length)return this.creatingInstanceClassQueue[this.creatingInstanceClassQueue.length-1]}createInstance(n,r){this.checkCircularDependencies(n),this.creatingInstanceClassQueue.push(n);const i=Reflect.getMetadata?.("design:paramtypes",n[e.originalClassPropName]??n);i&&this.handleConstructorArgs(r,i,n);try{const t=f.instance;let a;switch(t.handleInstanceLazyMembers(n),n[e.originalClassPropName]?(n[e.originalClassPropName][e.afterClassStoreInstanceCreatedCbName]=e=>{t.handleInstanceMembers(n,e)},a=new n(...r),delete n[e.originalClassPropName][e.afterClassStoreInstanceCreatedCbName]):(a=new n(...r),t.handleInstanceMembers(n,a)),s.instance.getInjectableOptions(n).setTo){case"inextensible":Object.preventExtensions(a);break;case"sealed":Object.seal(a);break;case"frozen":Object.freeze(a)}return this.creatingInstanceClassQueue.pop(),a}catch(e){a.throwError("39001",`依赖注入容器实例化类 "${n?.name}" 出错！${t}${e?.stack??e}`)}}checkCircularDependencies(e){let t;this.creatingInstanceClassQueue.length>0&&(t=this.creatingInstanceClassQueue[this.creatingInstanceClassQueue.length-1]);const n=this.dependenciesGraph.addNodeAndCheckRing(e,t);if(n){const e=n.map((e=>e.name)).join(" -> ");a.throwError("39002",`检测到循环依赖：${e}`)}}handleConstructorArgs(t,n,r){if(t.length>n.length)a.warn("20001",`为 "${r?.name}" 的构造方法配置的参数过多！`);else if(t.length<n.length){const r=n.length-t.length;for(let n=0;n<r;n++)t.push(e.AUTO)}const i=s.instance;for(let r=0;r<t.length;r++)if(t[r]===e.AUTO){if("function"==typeof n[r]&&i.contains(n[r])){t[r]=this.dependenciesSearcher.searchDependencyByClass(n[r]);continue}t[r]=void 0}}static get instance(){return d._instance||(d._instance=new d),d._instance}}class p{constructor(){this.cachedDependenciesMap=new Map,this.cachedDependencyKeysMap=new Map}addDependency(e,t,n){let r=this.cachedDependenciesMap.get(e);r||(r=new WeakMap,this.cachedDependenciesMap.set(e,r)),r.set(n,t)}getDependency(e,t){return this.cachedDependenciesMap.get(e)?.get(t)}removeDependency(e){return this.cachedDependencyKeysMap.delete(e),this.cachedDependenciesMap.delete(e)}addDependencyKey(e,t){this.cachedDependencyKeysMap.set(e,WeakRef?new WeakRef(t):t)}getDependencyKey(e){const t=this.cachedDependencyKeysMap.get(e);if(t)return WeakRef?t.deref():t}static get instance(){return p._instance||(p._instance=new p),p._instance}}class h{searchDependencyByClass(e,t){if(!e)return;const{usingClass:n,usingArgs:r,usingObject:s,afterInstanceCreate:a,afterInstanceFetch:i}=this.getUsingsByConfig(e,t);return s?(i?.(s,!1),s):this.searchDependency(n,r,a,i)}searchDependencyBySymbol(e,t){if(!e)return;const{usingClass:n,usingArgs:r,usingObject:s,afterInstanceCreate:a,afterInstanceFetch:i}=this.getUsingsBySymbolConfig(e,t);return s?(i?.(s,!1),s):this.searchDependency(n,r,a,i)}searchDependency(e,n,r,i){"function"!=typeof e&&a.throwError("29014",`配置使用的Class(${e})无效！`),Array.isArray(n)||a.throwError("29015",`配置的构造方法参数(${n})无效！`),r&&"function"!=typeof r&&a.throwError("29016","配置的afterInstanceCreate必须是函数！"),i&&"function"!=typeof i&&a.throwError("29017","配置的afterInstanceFetch必须是函数！");const o=s.instance.getInjectableOptions(e);let u;switch(o.type){case"singleton":const s=c.instance;u=s.getDependency(e),u?i?.(u,!1):(u=d.instance.createDependency(e,n),s.addDependency(e,u),r?.(u),i?.(u,!0));break;case"cached":const l=p.instance;let f=l.getDependencyKey(e);f?(u=l.getDependency(e,f),i?.(u,!1)):(u=d.instance.createDependency(e,n),f=o.follow?o.follow.call(u,u):u,f||a.throwError("29007",`follow方法的返回值不能为空！${t}class: ${e?.name}, 返回值: ${f}`),"object"!=typeof f&&a.throwError("29008",`follow方法的返回值必须是对象类型！${t}class: ${e?.name}, 返回值: ${f}`),l.addDependencyKey(e,f),l.addDependency(e,u,f),r?.(u),i?.(u,!0));break;default:u=d.instance.createDependency(e,n),r?.(u),i?.(u,!0)}return u}getUsingsByConfig(t,n){let r,s,c,u=n??[],l=t;for(;r!==l;){r=l;const n=i.instance.getConfigMethod(l);if(n){const r=new o(l,u),i=n(r,d.instance.getCreatingInstanceClass());if(i&&i!==e.STOP_DEEP_CONFIG){if(i instanceof t)return{usingObject:i,afterInstanceCreate:r.afterInstanceCreate,afterInstanceFetch:r.afterInstanceFetch};a.throwError("29002",`配置的对象不是 "${t?.name}" 或其子类的实例`)}if(l=r.usingClass,u=r.args,s=r.afterInstanceCreate,c=r.afterInstanceFetch,i===e.STOP_DEEP_CONFIG)return{usingClass:l,usingArgs:u??[],afterInstanceCreate:s,afterInstanceFetch:c}}}return{usingClass:r,usingArgs:u??[],afterInstanceCreate:s,afterInstanceFetch:c}}getUsingsBySymbolConfig(t,n){const r=i.instance.getConfigMethod(t);r||a.throwError("29021",`未找到该Symbol "${t.toString()}" 对应的依赖配置方法！如果您已经定义了方法，请确认该方法会被程序加载到，或者您可以使用registerDepsConfig()方法对其进行加载。`);const s=new o(void 0,n),c=r(s,d.instance.getCreatingInstanceClass());if(c&&c!==e.STOP_DEEP_CONFIG)return{usingObject:c,afterInstanceCreate:s.afterInstanceCreate,afterInstanceFetch:s.afterInstanceFetch};const u=s.usingClass;if(c===e.STOP_DEEP_CONFIG)return{usingClass:u,usingArgs:s.args??[],afterInstanceCreate:s.afterInstanceCreate,afterInstanceFetch:s.afterInstanceFetch};const l=this.getUsingsByConfig(u,s.args);return l.afterInstanceCreate||(l.afterInstanceCreate=s.afterInstanceCreate),l.afterInstanceFetch||(l.afterInstanceFetch=s.afterInstanceFetch),l}static get instance(){return h._instance||(h._instance=new h),h._instance}}function y(e){return function(n){(function(e){const t=s.instance;let n=Reflect.getPrototypeOf(e);for(;n;){if(t.contains(n)){const e=t.getInjectableOptions(n);if("singleton"===e?.type)return!0}n=Reflect.getPrototypeOf(n)}return!1})(n)&&a.throwError("29001",`禁止继承依赖类型为 "singleton" 的类！ 如果您需要单例的子类，请单独在子类上使用 "@Injectable({ type: 'singleton' })"${t}class: ${n.name}`);const r=s.instance;if(r.contains(n)&&a.throwError("29022",`禁止重复设置注入选项！class: ${n.name}`),r.collect(n,e),e?.injectOnNew){const e=function(...e){return h.instance.searchDependencyByClass(n,e)},t=Reflect.ownKeys(n);for(const r of t)"length"!==r&&"name"!==r&&Reflect.defineProperty(e,r,Reflect.getOwnPropertyDescriptor(n,r));return e}return n}}function g(e,t,n){const r=Reflect.getMetadata?.("design:type",e,t);r&&s.instance.contains(r)&&f.instance.addInjectMember(e,t,r,n)}function b(e,t,n,r){("function"!=typeof n||s.instance.contains(n))&&f.instance.addInjectMember(e,t,n,r)}function m(e,t,n){const r=Reflect.getMetadata?.("design:type",e,t);r&&s.instance.contains(r)&&f.instance.handleInstanceStaticMember(e,t,r,n)}function w(e,t,n,r){("function"!=typeof n||s.instance.contains(n))&&f.instance.handleInstanceStaticMember(e,t,n,r)}var v;Object.create,Object.create;class O{constructor(){this.keyedDependenciesMap=new Map,this.weakKeyedDependenciesMap=new Map}addDependency(e,t,n,r){if(r){"object"!=typeof n&&a.throwError("29018","将非object类型用作了weakKeyedDependenciesMap对象中WeakMap的键！"),this.keyedDependenciesMap.get(e)?.delete(n);let r=this.weakKeyedDependenciesMap.get(e);r||(r=new WeakMap,this.weakKeyedDependenciesMap.set(e,r)),r.set(n,t)}else{"object"==typeof n&&this.weakKeyedDependenciesMap.get(e)?.delete(n);let r=this.keyedDependenciesMap.get(e);r||(r=new Map,this.keyedDependenciesMap.set(e,r)),r.set(n,t)}}getDependency(e,t){let n=this.keyedDependenciesMap.get(e)?.get(t);return n||("object"==typeof t&&(n=this.weakKeyedDependenciesMap.get(e)?.get(t),n)?n:void 0)}containsDependency(e,t){let n=this.keyedDependenciesMap.get(e)?.has(t);return!!n||!("object"!=typeof t||(n=this.weakKeyedDependenciesMap.get(e)?.has(t),!n))}removeDependency(e,t){let n=this.keyedDependenciesMap.get(e)?.delete(t);return!!n||!(n||"object"!=typeof t||(n=this.weakKeyedDependenciesMap.get(e)?.delete(t),!n))}static get instance(){return O._instance||(O._instance=new O),O._instance}}class _{get alreadyBuilt(){return this._alreadyBuilt}setValues(e){this._alreadyBuilt=!0,null!=e&&("object"!=typeof e&&a.throwError("29010","构建值依赖管理器的初始值必须是object类型！"),this.modularValues=e)}patchValue(t,n){"string"!=typeof t&&a.throwError("19001","key必须是string类型！"),this.modularValues||(this.modularValues={});const r=t.split(".");let s=this.modularValues;for(let t=0;t<r.length-1;t++){let n=s[e.MODULE];n||(n={},s[e.MODULE]=n);let a=n[r[t]];a||(a={},n[r[t]]=a),s=a}s[r[r.length-1]]=n}takeValue(t){if("string"!=typeof t&&a.throwError("29012","key必须是string类型！"),!this.modularValues)return;const n=t.split(".");let r=this.modularValues;for(let t=0;t<n.length-1;t++)if(r=r?.[e.MODULE]?.[n[t]],!r)return;return r[n[n.length-1]]}static get instance(){return _._instance||(_._instance=new _),_._instance}}function M(e,t){"string"!=typeof e&&a.throwError("29013","key必须是string类型！");const n=2===arguments.length;return function(r,s){Reflect.defineProperty(r,s,{enumerable:!0,configurable:!0,get(){const r=_.instance.takeValue(e);return null==r&&n?t:r},set(){a.error("21002","被InjectVal()装饰器装饰的属性为只读属性，无法赋值！")}})}}let C=v=class{#n=O.instance;#r=c.instance;constructor(){this.#r.getDependency(v)&&a.throwError("29003","请通过依赖查找或依赖注入的方式获取MushroomService实例！")}addDependencyWithKey(e,n,r){n||a.throwError("29005",`向Mushroom容器中添加的对象不能为空！${t}class: ${e.name}`),this.#n.addDependency(e,n,r)}addDependencyWithWeakKey(e,n,r){n||a.throwError("29006",`向Mushroom容器中添加的对象不能为空！${t}class: ${e.name}`),this.#n.addDependency(e,n,r,!0)}getDependencyByKey(e,t){return this.#n.getDependency(e,t)}containsDependencyWithKey(e,t){return this.#n.containsDependency(e,t)}removeDependencyByKey(e,t){return this.#n.removeDependency(e,t)}destroyCachedInstance(e){return p.instance.removeDependency(e)}destroySingletonInstance(e){return e===v&&a.throwError("29004","禁止销毁MushroomService实例！"),this.#r.removeDependency(e)}buildValueDepsManager(e){const t=_.instance;return t.alreadyBuilt&&a.throwError("29009","不能重复构建值依赖管理器！"),t.setValues(e),{patchVal:function(e,n){if("string"==typeof e)t.patchValue(e,n);else for(const n of Object.keys(e))t.patchValue(n,e[n])},takeVal:function(...e){if(1===e.length)return t.takeValue(e[0]);const n=[];for(const r of e)n.push(t.takeValue(r));return n},InjectVal:M}}static setGlobalConfig(t){if(e.globalConfigAlreadySet&&a.throwError("29023","禁止重复设置全局配置！"),e.defaultConfigAlreadyGot&&a.warn("20002","在设置全局配置前已经使用过默认配置！"),t.defaultInjectableOptions)for(const n of Object.keys(t.defaultInjectableOptions))e.defaultInjectableOptions[n]=t.defaultInjectableOptions[n];if(t.defaultInjectOptions)for(const n of Object.keys(t.defaultInjectOptions))e.defaultInjectOptions[n]=t.defaultInjectOptions[n];e.globalConfigAlreadySet=!0}};C=v=function(e,t,n,r){var s,a=arguments.length,i=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(i=(a<3?s(i):a>3?s(t,n,i):s(t,n))||i);return a>3&&i&&Object.defineProperty(t,n,i),i}([y({type:"singleton",setTo:"frozen"}),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:paramtypes",[])}()],C);const I=h.instance;function D(...e){return 1===e.length?I.searchDependencyByClass(e[0]):e.map((e=>I.searchDependencyByClass(e)))}function j(e,...t){return I.searchDependencyByClass(e,t)}function k(e,...t){return I.searchDependencyBySymbol(e,t)}function E(e,t){t&&delete t.injectOnNew,P(t)(e)}function S(e,t){T(e)(null,null,{value:t})}const P=y,T=function(e){return(t,n,r)=>{i.instance.collect(e,r.value)}},N=function(e,t){const n=arguments.length;return function(r,s){const a=function(e){return!!e.prototype}(r);0===n?a?m(r,s):g(r,s):1===n?"function"==typeof e||"symbol"==typeof e?a?w(r,s,e):b(r,s,e):null==e?a?m(r,s):g(r,s):a?m(r,s,e):g(r,s,e):2===n&&(null==e?a?m(r,s,t):g(r,s,t):a?w(r,s,e,t):b(r,s,e,t))}},R=C,x=e.AUTO,A=e.STOP_DEEP_CONFIG,F=e.MODULE;function K(e){}D(R)})(),r})()));
//# sourceMappingURL=index.js.map